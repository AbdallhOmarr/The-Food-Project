{% extends 'base.html' %}
{% load static %}
{% block title %}About The Food Project{% endblock %}

{% block body %}
<div class="container">
    <div id="restaurant-rows" class="py-4"></div>
</div>
<script>
    // Get the container element for the rows
    var container = document.getElementById("restaurant-rows");

    // Create a new row
    var row = document.createElement("div");
    row.classList.add("row");
    // Create a counter to keep track of the number of restaurants in the current row
    var counter = 0;
    {% comment %} import { reverse } from 'django-urls'; {% endcomment %}
    async function getData(){
        const response1 = await fetch('{% url "restaurantsData" %}');
        const restaurants = await response1.json();
        const userID = "{{request.user.id}}";

        const response2 = await fetch("{% url 'voteGET'%}")
        const votesData = await response2.json();
        for (var i = 0; i < restaurants.length; i++) {
            let restaurantVote;
            //get votes for restaurant
            let restaurantVoteArray = []
            votesData.forEach(item=>{
                if(item.restaurant == restaurants[i].id) restaurantVoteArray.push(item)
            })
            console.log("resturant votes array")
            if(restaurantVoteArray.length === 0) {
                console.log("resturant vote array is 0")
                restaurantVote =0;
            } else {
                console.log("resturant vote array isnot 0")

                restaurantVote = restaurantVoteArray[0].restaurant;

            }
                        // Create a column for the current restaurant
            var col = document.createElement("div");
            col.classList.add("col-md-4","py-4");
    
            // Create the restaurant card
            var card = document.createElement("div");
            card.classList.add("card", "bg-light", "text-dark","card-size");
    
            // Add the restaurant details to the card
            var cardBody = document.createElement("div");
            cardBody.classList.add("card-body", "text-center");
            cardBody.innerHTML = `
              <div class="h1 mb-1">
                <img src="${restaurants[i].logo}" class="img-thumbnail logo-size" alt="">
              </div>
              <p class="cardTitle">${restaurants[i].name}</p>
              <p class="cardTitle">${restaurants[i].phone_number}</p>
              <form>
                <input type="text" id="number-${restaurants[i].id}" value="${restaurantVote}" readonly="readonly" />
                <input type="button" id="button-${restaurants[i].id}" onclick="incrementValue(${userID},${restaurants[i].id})" value="Vote" />
              </form>
            `;
            card.appendChild(cardBody);
    
            // Add the card to the column
            col.appendChild(card);
    
            // Add the column to the current row
            row.appendChild(col);
    
            // Increment the counter
            counter++;
    
            // Check if the current row is full
            if (counter % 3 === 0) {
                // Add the row to the container
                container.appendChild(row);
    
                // Create a new row
                row = document.createElement("div");
                row.classList.add("row");

            }
        }  
        container.appendChild(row);

    }
    getData();
    // Iterate over the restaurants
    {% comment %} {% endcomment %}
 
    // Add the remaining row to the container
</script>
{% endblock %}